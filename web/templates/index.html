<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Local Research Agent</title>
    <link rel="stylesheet" href="/static/css/style.css?v=2">
</head>
<body>
    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <span class="sidebar-title">History</span>
            <button id="btn-close-sidebar" class="btn-icon">&times;</button>
        </div>
        <div id="history-list" class="sidebar-content">
            <p id="history-empty" class="sidebar-empty">No reports yet. Start a research to see results here.</p>
        </div>
    </aside>
    <div id="sidebar-overlay" class="sidebar-overlay"></div>

    <!-- Main Area -->
    <div class="main-wrapper">
        <!-- Top Bar -->
        <header class="top-bar">
            <button id="btn-sidebar" class="btn-icon sidebar-toggle">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                    <line x1="3" y1="6" x2="21" y2="6"/>
                    <line x1="3" y1="12" x2="21" y2="12"/>
                    <line x1="3" y1="18" x2="21" y2="18"/>
                </svg>
            </button>
            <span class="brand">Local Research Agent</span>
            <div id="health-status" class="health-dot" title="Checking..."></div>
        </header>

        <!-- Scrollable Content Area -->
        <div class="content-area" id="content-area">
            <!-- Welcome / Idle State -->
            <div id="view-welcome" class="welcome-view">
                <div class="welcome-inner">
                    <h1 class="welcome-title">What would you like to research?</h1>
                    <p class="welcome-subtitle">AI-powered deep research, running entirely on your machine.</p>
                    <div id="example-topics" class="example-topics"></div>
                </div>
            </div>

            <!-- Progress Panel -->
            <div id="view-progress" class="progress-view" style="display:none;">
                <article class="progress-panel">
                    <div class="progress-header">
                        <span id="progress-status">Starting...</span>
                        <span id="progress-time">0s</span>
                    </div>
                    <div class="progress-bar-track">
                        <div id="progress-bar" class="progress-bar-fill" style="width:0%"></div>
                    </div>

                    <div id="progress-queries" style="display:none;">
                        <h4>Search Queries</h4>
                        <ul id="queries-list"></ul>
                    </div>

                    <div id="progress-urls" style="display:none;">
                        <h4>URLs Found <span id="url-count" class="badge">0</span></h4>
                        <ul id="urls-list" class="url-list"></ul>
                    </div>

                    <div id="progress-scraping" style="display:none;">
                        <h4>Scraping <span id="scrape-count" class="badge">0/0</span></h4>
                        <ul id="scrape-list" class="scrape-list"></ul>
                    </div>

                    <div id="progress-complete" style="display:none;">
                        <div class="complete-stats" id="complete-stats"></div>
                        <a id="btn-view-report" href="#" class="btn btn-primary">View Report</a>
                    </div>

                    <div id="progress-error" style="display:none;">
                        <p class="error-message" id="error-message"></p>
                    </div>
                </article>
            </div>

            <!-- Report View -->
            <section id="view-report" class="report-view" style="display:none;">
                <div class="report-header">
                    <button id="btn-back" class="btn btn-ghost">&larr; Back</button>
                    <div class="report-actions">
                        <button id="btn-download" class="btn btn-outline">Download</button>
                        <button id="btn-delete" class="btn btn-outline btn-danger">Delete</button>
                    </div>
                </div>
                <div id="report-meta" class="report-meta"></div>
                <div id="report-content" class="report-body"></div>
            </section>
        </div>

        <!-- Bottom Input Bar -->
        <div class="input-bar">
            <form id="research-form" class="input-form">
                <input type="text" id="topic" name="topic"
                       placeholder="Enter a research topic..."
                       autocomplete="off" required>
                <button type="submit" id="btn-start" class="btn-send" title="Start Research">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                    </svg>
                </button>
            </form>
            <details class="settings-details">
                <summary>Settings</summary>
                <div class="settings-grid">
                    <label>
                        <span>Model</span>
                        <input type="text" id="setting-model" value="llama3.1:8b-instruct-q8_0">
                    </label>
                    <label>
                        <span>Queries</span>
                        <input type="number" id="setting-queries" value="3" min="1" max="10">
                    </label>
                    <label>
                        <span>Results / Query</span>
                        <input type="number" id="setting-results" value="3" min="1" max="10">
                    </label>
                    <div class="theme-toggle">
                        <span>Theme</span>
                        <button id="btn-theme-toggle" class="theme-toggle-btn" type="button" title="Toggle theme">
                            <svg id="theme-icon-sun" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:none;">
                                <circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                            </svg>
                            <svg id="theme-icon-moon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </details>
        </div>
    </div>

    <!-- Markdown renderer -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- App scripts -->
    <script src="/static/js/api.js"></script>
    <script src="/static/js/research.js"></script>
    <script src="/static/js/history.js"></script>
    <script src="/static/js/report.js"></script>
    <script src="/static/js/app.js"></script>
</body>
</html>
